<!DOCTYPE html>
<html>
	<head>
		<title>Something interesting</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, height=device-height, user-scalable=no" />
		<link rel="stylesheet" href="style.css"></link>
	</head>
	<body>
		<script>
			var cacheName = 'phaser-game';
			var filesToCache = [
				'/',
				'/index.html',
				'/style.css',
				'/audio/Flags on the Moon.wav',
				'/js/game.js',
				'/js/phaser.min.js',
				'/js/Tone.min.js'
			];

			if('serviceWorker' in navigator) {
				window.addEventListener('load', function() {
					navigator.serviceWorker.register('sw.js', {scope: '/'}).then(
						function(registration) {
							console.log('ServiceWorker registration successful with scope: ', registration.scope);
						}, function(err) {
							console.log('ServiceWorker registration failed: ', err);
						});
				});
			}
			
			self.addEventListener('install', function(event) {
				console.log('sw install');
				event.waitUntil(
					caches.open(cacheName).then(function(cache) {
						console.log('sw caching files');
						return cache.addAll(filesToCache);
					}).catch(function(err) {
						console.log(err);
					})
				);
			});

			self.addEventListener('fetch', function(event) {
				console.log('sw fetch');
				console.log(event.request.url);
				event.respondWith(
					caches.match(event.request).then(function(response) {
						return response || fetch(event.request);
					}).catch(function(error) {
						console.log(error);
					})
				);
			});

			self.addEventListener('activate', function(event) {
				console.log('sw activate');
				event.waitUntil(
					caches.keys().then(function(keyList) {
						return Promise.all(keyList.map(function(key) {
							if(key !== cacheName) {
								console.log('sw removing old cache', key);
								return caches.delete(key);
							}
						}));
					})
				);
			});
		</script>
		<script src="js/phaser.min.js"></script>
		<script src="js/Tone.min.js"></script>
		<script src="js/game.js"></script>
	</body>
</html>
